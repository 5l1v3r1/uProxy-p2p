<html>

<head>
  <meta charset="UTF-8">
  <script src='scripts/stack_panel.js'></script>
  <script src="/third_party/bower/webcomponentsjs/webcomponents.js"></script>
  <link rel='import' href='views/metrics-choice-view.html'>
  <link rel='import' href='views/welcome-view.html'>
  <style>
  </style>
</head>

<body>
  <div id='root-panel'></div>
  <script>
    'use strict';

    class Settings {
      constructor() {
        this.language = null;
        this.enableMetrics = false;
      }
      setLanguage(language) {
        this.language = language;
      }
      enableMetrics(enable) {
        this.enableMetrics = enable;
      }
    }

    class HomeViewUnwrapped extends HTMLElement {
      createdCallback() {
        this.innerHTML = '<h1>Home</h1>' +
          '<p><button>Get Access from Peer</button></p>' +
          '<p><button>Get Access from Cloud Proxy</button></p>' +
          '<p><button>Share Access</button></p>';
      }
    }
    const HomeView = document.registerElement('home-view', HomeViewUnwrapped);

    function makeTranslator(language) {
      let messages = {
        ar: {
          BACK: 'عودة',
          NEXT: 'التالى',
          WELCOME: 'أهلا بك'
        },
        en: {
          BACK: 'Back',
          NEXT: 'Next',
          METRICS_CHOICE_TITLE: 'Metrics Choice',
          METRICS_OPT_IN: 'Opt-In',
          METRICS_OPT_OUT: 'Opt-Out',
          WELCOME: 'Welcome'
        },
        es: {
          BACK: 'Volver',
          NEXT: 'Proximo',
          WELCOME: 'Bienvenido'
        },
        zh: {
          BACK: '返回',
          NEXT: '下一个',
          WELCOME: '欢迎'
        }
      };
      return function(msgId) {
        if (!messages[language]) { return msgId; }
        return messages[language][msgId] || messages['en'][msgId] || msgId;
      };
    }

    function main() {
      let settings = new Settings();
      let stack_panel = new StackPanel(document.getElementById('root-panel'));
      let welcome_view = new WelcomeView();
      welcome_view.languageList = [
        {code: 'en', name: 'English'},
        {code: 'ar', name: 'Arabic'},
        {code: 'zh', name: 'Chinese'},
        {code: 'es', name: 'Spanish'}
      ];
      welcome_view.selectedLanguage = 'zh';
      welcome_view.onLanguageSelected((language) => {
        settings.setLanguage(language);
        welcome_view.msg = makeTranslator(language);
      });
      welcome_view.onDone(() => {
        let choice_view = new MetricsChoiceView();
        choice_view.msg = makeTranslator(settings.language);
        choice_view.onBack(() => { stack_panel.popView(); })
        choice_view.onMetricsChoiceMade((optIn) => {
          settings.enableMetrics(optIn);
        });
        choice_view.onDone(() => {
          stack_panel.popViews(2);
          stack_panel.pushView(new HomeView());
          console.log('Settings: ', settings);
        });
        stack_panel.pushView(choice_view);
      });
      stack_panel.pushView(welcome_view);
    }

    window.addEventListener('polymer-ready', main);
  </script>
</body>
</html>