<link rel="import" href="/third_party/bower/core-menu/core-menu.html">
<link rel="import" href="/third_party/bower/paper-button/paper-button.html">
<link rel="import" href="/third_party/bower/paper-dropdown/paper-dropdown.html">
<link rel="import" href="/third_party/bower/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel='import' href='/third_party/bower/paper-item/paper-item.html'>

<polymer-element name='uproxy-welcome-view' constructor='WelcomeView'>
  <template>
    <!--<h1>{{'WELCOME' | msg(selectedLanguage)}}</h1>
    <h1>{{ msg('WELCOME', selectedLanguage )}}</h1>-->
    <h1>{{ msg && msg('WELCOME') }}</h1>
    <core-icon icon="language"></core-icon>
    <paper-dropdown-menu>
      <paper-dropdown class="dropdown">
        <core-menu id="menu" valueattr='value' selected='{{selectedLanguage}}'>
          <template repeat='{{ language in languageList }}'>
            <paper-item value='{{language.code}}'>{{msg && msg(language.name)}}</paper-item>
          </template>
        </core-menu>
      </paper-dropdown>
    </paper-dropdown-menu>
    <paper-button on-click='{{handleNext_}}'>{{msg && msg('NEXT')}}</paper-button>
  </template>

  <script>
    Polymer({
      // Injected configuration
      publish: {
        selectedLanguage: null,
        languageList: []
      },
      msg: null,
      created: function() {
        let view = this;
        this.selectedLanguageStream = Rx.Observable.create(function(observer) {
          view.selectedLanguageObserver_ = observer;
        }).do((language) => {
          console.log('Selected language ', language);
        }).publish();
        this.done = new Promise((finish) => {
          view.doneFulfill_ = finish;
        });
      }
      // Private methods
      selectedLanguageChanged(oldLanguage, newLanguage) {
        this.selectedLanguageObserver_.OnNext(newLanguage);
      },
      handleNext_: function(event) {
        this.selectedLanguageObserver_.OnNext(this.selectedLanguage)
        this.doneFulfill_();
      },
    });
  </script>
</polymer-element>